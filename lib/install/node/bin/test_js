#!/usr/bin/env bash
set -e

export IMPORTMAP_PATH=$(bin/rails importest:export)
export NODE_PATH=test/javascript/node_modules

NODE_MAJOR=$(node -v | cut -d. -f1 | tr -d 'v')
if [ "$NODE_MAJOR" -lt 24 ]; then
  NODE_FLAGS="--experimental-default-type=module"
else
  NODE_FLAGS=""
fi

exec node $NODE_FLAGS --import ./test/javascript/node_importmap_loader.mjs --test test/javascript/**/*.test.js
